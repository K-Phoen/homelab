# {{ ansible_managed }}
# https://0xerr0r.github.io/blocky/latest/configuration/

bootstrapDns:
  - upstream: tcp-tls:dns.mullvad.net
    ips:
      - 194.242.2.2
  - upstream: tcp-tls:dns0.eu
    ips:
      - 193.110.81.0
      - 185.253.5.0
  - upstream: tcp-tls:dns.quad9.net
    ips:
      - 9.9.9.9
      - 149.112.112.112
  - upstream: tcp-tls:unicast.uncensoreddns.org
    ips:
      - 89.233.43.71

upstreams:
  timeout: 2s
  strategy: parallel_best

  groups:
    default:
      # Quad9
      - tcp-tls:dns.quad9.net:853

      # Mullvad
      - tcp-tls:dns.mullvad.net:853

      # https://blog.uncensoreddns.org/
      - tcp-tls:unicast.uncensoreddns.org:853

customDNS:
  customTTL: 1h
  filterUnmappedTypes: true
  rewrite:
    lan: lab
    homelab: lab
    home: lab
  mapping:
    beet.lab: 10.10.10.37
    bean.lab: 10.10.10.91
    carrot.lab: 10.10.10.64
    celery.lab: 10.10.10.14
    potato.lab: 10.10.10.122
    nanoflux.lab: 10.10.10.122 # tmp: for dev purposes
    k3s.lab: 10.10.10.212 # VIP for k3s control plane
    # 10.10.10.191 is traefik VIP
    # 10.10.10.194 is forgejo-ssh VIP
    argocd.kevingomez.fr: 10.10.10.191
    auth.kevingomez.fr: 10.10.10.191
    blog.kevingomez.fr: 10.10.10.191
    calendars.kevingomez.fr: 10.10.10.191
    downloads.kevingomez.fr: 10.10.10.191
    git.kevingomez.fr: 10.10.10.191
    git-ssh.kevingomez.fr: 10.10.10.194
    home.kevingomez.fr: 10.10.10.191
    ldap.kevingomez.fr: 10.10.10.191
    lidarr.kevingomez.fr: 10.10.10.191
    prowlarr.kevingomez.fr: 10.10.10.191
    radarr.kevingomez.fr: 10.10.10.191
    rss.kevingomez.fr: 10.10.10.191
    shiori.kevingomez.fr: 10.10.10.191
    sonarr.kevingomez.fr: 10.10.10.191
    tv.kevingomez.fr: 10.10.10.191
    traefik.kevingomez.fr: 10.10.10.191
    translate.kevingomez.fr: 10.10.10.191
    www.kevingomez.fr: 10.10.10.191

caching:
  minTime: 5m
  prefetching: true
  prefetchThreshold: 15

prometheus:
  enable: true
  path: /metrics

blocking:
  loading:
    strategy: fast
    refreshPeriod: 24h
    downloads:
      timeout: 15m
      attempts: 5
      cooldown: 15s

  denylists:
    ads:
      - https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
    mixed:
      - https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/wildcard/pro.txt # see https://github.com/hagezi/dns-blocklists?tab=readme-ov-file#ledger-multi-pro---extended-protection-recommended-
      - https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/wildcard/popupads.txt # see https://github.com/hagezi/dns-blocklists?tab=readme-ov-file#tada-pop-up-ads---protects-against-annoying-and-malicious-pop-up-ads-
      - https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/wildcard/native.tiktok.extended.txt # https://github.com/hagezi/dns-blocklists?tab=readme-ov-file#calling-native-tracker---broadband-tracker-of-devices-services-and-operating-systems- (tiktok)
    security:
      - https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/wildcard/popupads.txt # see https://github.com/hagezi/dns-blocklists?tab=readme-ov-file#closed_lock_with_key-threat-intelligence-feeds---increases-security-significantly-recommended-
      - https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/wildcard/hoster.txt # https://github.com/hagezi/dns-blocklists?tab=readme-ov-file#computer-badware-hoster-blocking---protects-against-the-malicious-use-of-free-host-services-

  clientGroupsBlock:
    default:
      - ads
      - mixed
      - security

log:
  level: warn

ports:
  dns: 53
  http: 4000
  https: 4434 # don't want to use it: I want nginx to serve HTTPS first.
